{% extends "base.html" %}

{% block content %}
<div class="max-w-md mx-auto mt-10">
    <div class="glass-card p-8 rounded-2xl">
        <h2 class="text-3xl font-bold text-white mb-6 text-center">Criar Conta</h2>
        
        <form action="{{ url_for('register') }}" method="POST" class="space-y-6">
            <div>
                <label for="username" class="block text-sm font-medium text-slate-400 mb-2">Nome de Usuário</label>
                <input type="text" name="username" id="username" required 
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
            </div>

            <div>
                <label for="email" class="block text-sm font-medium text-slate-400 mb-2">Email</label>
                <input type="email" name="email" id="email" required 
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
            </div>

            <div>
                <label for="cpf" class="block text-sm font-medium text-slate-400 mb-2">CPF</label>
                <input type="text" name="cpf" id="cpf" required maxlength="14"
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent transition"
                    placeholder="000.000.000-00" oninput="maskCPF(this)">
            </div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-slate-400 mb-2">Senha</label>
                <input type="password" name="password" id="password" required 
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
            </div>

            <button type="submit" class="w-full bg-violet-600 hover:bg-violet-700 text-white font-bold py-3 rounded-lg transition shadow-lg shadow-violet-500/20">
                Criar Conta
            </button>
        </form>

        <div class="mt-6 text-center text-sm text-slate-400">
            Já tem uma conta? <a href="{{ url_for('login') }}" class="text-violet-400 hover:text-violet-300 font-medium">Entrar</a>
        </div>
    </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const cpfInput = document.getElementById('cpf');
        const form = document.querySelector('form');
        
        // CPF Mask
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 9) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
            } else if (value.length > 3) {
                value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
            }
            
            e.target.value = value;
            validateCPFInput(e.target);
        });

        // Form Submission Validation
        form.addEventListener('submit', function(e) {
            const cpf = cpfInput.value.replace(/\D/g, '');
            if (!isValidCPF(cpf)) {
                e.preventDefault();
                alert('Por favor, insira um CPF válido.');
                cpfInput.focus();
                cpfInput.classList.add('border-red-500', 'ring-2', 'ring-red-500');
            }
        });

        function validateCPFInput(input) {
            const cpf = input.value.replace(/\D/g, '');
            if (cpf.length === 11) {
                if (isValidCPF(cpf)) {
                    input.classList.remove('border-red-500', 'ring-red-500', 'ring-2');
                    input.classList.add('border-green-500', 'ring-green-500', 'ring-2');
                } else {
                    input.classList.remove('border-green-500', 'ring-green-500', 'ring-2');
                    input.classList.add('border-red-500', 'ring-red-500', 'ring-2');
                }
            } else {
                input.classList.remove('border-green-500', 'ring-green-500', 'border-red-500', 'ring-red-500', 'ring-2');
            }
        }

        function isValidCPF(cpf) {
            if (typeof cpf !== "string") return false;
            cpf = cpf.replace(/[\s.-]*/gbm, '');
            if (cpf.length !== 11 || !!cpf.match(/(\d)\1{10}/)) return false;
            let values = cpf.split('').map(el => +el);
            let rest = (values.slice(0, 9).reduce((s, n, i) => s + n * (10 - i), 0) * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== values[9]) return false;
            rest = (values.slice(0, 10).reduce((s, n, i) => s + n * (11 - i), 0) * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            return rest === values[10];
        }
    });
</script>
{% endblock %}
